# GitHub Repository Settings
# This file is used by the GitHub Settings app (Probot) to manage repository configuration
# Reference: https://github.com/probot/settings

# Repository settings
repository:
  # Repository description
  description: "OpenWrt Captive Monitor - Automatic recovery from captive portals on OpenWrt routers"
  homepage: https://github.com/nagual2/openwrt-captive-monitor
  
  # Visibility and access
  private: false
  has_issues: true
  has_projects: false
  has_wiki: false
  has_downloads: true
  
  # Default branch
  default_branch: main
  
  # Security and analysis features
  allow_squash_merge: true
  allow_merge_commit: false
  allow_rebase_merge: false
  delete_branch_on_merge: true
  require_linear_history: true
  
  # Automatically dismiss stale PR approvals when new commits are pushed
  dismiss_stale_reviews: true
  
  # Require code reviews and approvals before merging
  require_code_owner_reviews: false

# Security and analysis features
# These settings enable GitHub's automated security scanning and dependency management
security_and_analysis:
  # Enable dependency graph (required for other features)
  dependency_graph:
    status: enabled
  
  # Enable Dependabot alerts
  dependabot_alerts:
    status: enabled
  
  # Enable Dependabot security updates (automatically opens PRs for security patches)
  dependabot_security_updates:
    status: enabled
  
  # Enable secret scanning
  secret_scanning:
    status: enabled
  
  # Enable secret scanning push protection (prevents pushing secrets)
  secret_scanning_push_protection:
    status: enabled

# Branch protection rules
branches:
  - name: main
    # Require pull request reviews before merging
    protection:
      # Require a pull request before merging
      required_pull_request_reviews:
        # Minimum number of approving reviews
        required_approving_review_count: 1
        # Dismiss approved reviews if new commits are pushed
        dismiss_stale_reviews: true
        # Require code owner review
        require_code_owner_reviews: false
        # Restrict review dismissal
        restrict_dismissals: false
      
      # Require status checks to pass before merging
      required_status_checks:
        strict: true  # Require branches to be up to date before merging
        # The following status checks are required
        contexts:
          # CI Workflow - Linting and formatting checks
          - "Lint (shfmt)"
          - "Lint (shellcheck)"
          - "Lint (markdownlint)"
          - "Lint (actionlint)"
          
          # CI Workflow - Testing
          - "Test"
          
          # CodeQL Security Scanning
          - "CodeQL Analysis (python)"
          - "ShellCheck Security Analysis"
          
          # Security Scanning Workflow
          - "Dependency Review"
          - "Trivy Security Scan"
          - "Bandit Python Security Scan"
      
      # Restrict who can push to matching branches
      restrictions:
        # Limit push access to maintainers
        users: []
        teams: []
        apps: []
      
      # Require all conversations to be resolved before merging
      required_conversation_resolution: true
      
      # Require signed commits
      require_signed_commits: false
      
      # Require status checks to pass before merging
      enforce_admins: true
      
      # Prevent force pushes and deletions
      allow_force_pushes: false
      allow_deletions: false
