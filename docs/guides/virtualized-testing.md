# –í–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ OpenWrt Captive Monitor

---

## üåê Language / –Ø–∑—ã–∫

**English** | [–†—É—Å—Å–∫–∏–π](#—Ä—É—Å—Å–∫–∏–π)

---


> –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è OpenWrt –≤ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ä–µ–¥–µ –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –ø–∞–∫–µ—Ç–æ–≤ –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏ captive monitor.

## üìã –û–±–∑–æ—Ä

–î–∞–Ω–Ω—ã–π –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ openwrt-captive-monitor, –¥–æ–ø–æ–ª–Ω—è—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π [—Ç–µ—Å—Ç-–ø–ª–∞–Ω](../TEST_PLAN.md) —ç–º—É–ª—è—Ü–∏–µ–π –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–π —Å—Ä–µ–¥—ã OpenWrt. –í–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø—Ä–æ–≤–æ–¥–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º–∞—Ö OpenWrt –±–µ–∑ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∏–∑–∏—á–µ—Å–∫–æ–≥–æ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏—è.

## üèóÔ∏è –ê–Ω–∞–ª–∏–∑ –ø–ª–∞—Ç—Ñ–æ—Ä–º –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏

### QEMU —Å KVM —É—Å–∫–æ—Ä–µ–Ω–∏–µ–º
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ù–∞—Ç–∏–≤–Ω–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –¥–ª—è x86_64 –≥–æ—Å—Ç–µ–≤—ã—Ö —Å–∏—Å—Ç–µ–º
- –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —ç–º—É–ª—è—Ü–∏–∏ —Å–µ—Ç–∏ (virtio-net)
- –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å CI/CD —Å–∏—Å—Ç–µ–º–∞–º–∏
- –®–∏—Ä–æ–∫–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤ –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤–∞—Ö Linux
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–µ–ø—à–æ—Ç–æ–≤ –∏ –æ—Ç–ª–∞–¥–∫–∏

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢—Ä–µ–±—É–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏ –Ω–∞ —Ö–æ—Å—Ç–µ (VT-x/AMD-V)
- –ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ –≤ GitHub Actions (–Ω–µ—Ç nested virtualization)
- –ë–æ–ª–µ–µ —Å–ª–æ–∂–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö bridge

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π –≤—ã–±–æ—Ä –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ dedicated CI runners.

### QEMU TCG (–ø–æ–ª–Ω–∞—è —ç–º—É–ª—è—Ü–∏—è)
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –†–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∞–ø–ø–∞—Ä–∞—Ç–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏
- –ü–æ–ª–Ω–æ—Å—Ç—å—é —Å–æ–≤–º–µ—Å—Ç–∏–º —Å GitHub Actions runners
- –ï–¥–∏–Ω–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è –≤—Å–µ—Ö —Ö–æ—Å—Ç–æ–≤
- –ù–∞–¥—ë–∂–Ω–∞—è –∏–∑–æ–ª—è—Ü–∏—è

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ –Ω–∏–∂–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (3-5x –º–µ–¥–ª–µ–Ω–Ω–µ–µ)
- –í—ã—Å–æ–∫–æ–µ –ø–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ CPU
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –ø–æ –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ç–∏
- –î–ª–∏—Ç–µ–ª—å–Ω–æ–µ –≤—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–∏—Å—Ç–µ–º—ã

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è GitHub Actions, –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è smoke-—Ç–µ—Å—Ç–æ–≤.

### Containerized OpenWrt rootfs
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –Ω–∞–∫–ª–∞–¥–Ω—ã–µ —Ä–∞—Å—Ö–æ–¥—ã
- –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- –≠—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Ä–µ—Å—É—Ä—Å–æ–≤
- –ü—Ä–æ—Å—Ç–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Docker

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å (–Ω–µ—Ç –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–æ–≥–æ —Å–µ—Ç–µ–≤–æ–≥–æ —Å—Ç–µ–∫–∞)
- –ü—Ä–æ–±–ª–µ–º—ã —Å —ç–º—É–ª—è—Ü–∏–µ–π firewall –ø—Ä–∞–≤–∏–ª
- –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞—Å—Ç–æ—è—â–µ–π –∏–∑–æ–ª—è—Ü–∏–∏ —Å–µ—Ç–∏
- –°–ª–æ–∂–Ω–æ—Å—Ç–∏ —Å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ–º init-—Å–∫—Ä–∏–ø—Ç–æ–≤

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** –ü–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è unit-—Ç–µ—Å—Ç–æ–≤, –Ω–æ –Ω–µ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è captive monitor.

### VirtualBox/VMware
**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –î—Ä—É–∂–µ–ª—é–±–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –•–æ—Ä–æ—à–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–Ω–µ–ø—à–æ—Ç–æ–≤
- –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏:**
- –¢—Ä–µ–±—É–µ—Ç GUI –¥–ª—è –ø–µ—Ä–≤–æ–Ω–∞—á–∞–ª—å–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- –ü—Ä–æ–±–ª–µ–º—ã —Å –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–µ–π –≤ headless —Ä–µ–∂–∏–º–µ
- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
- –ù–µ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è CI/CD

**–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏:** –¢–æ–ª—å–∫–æ –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏.

## üì¶ –ê—Ä—Ç–µ—Ñ–∞–∫—Ç—ã OpenWrt x86

### –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–µ–ª–∏–∑–Ω—ã–µ –∫–∞–Ω–∞–ª—ã
- **Stable:** OpenWrt 24.10 LTS (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
- **Testing:** OpenWrt 25.01 (–¥–ª—è —Ä–∞–Ω–Ω–µ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π)
- **Snapshot:** –ü–æ—Å–ª–µ–¥–Ω–∏–µ —Å–±–æ—Ä–∫–∏ (–¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏)

### –¢–∏–ø—ã –æ–±—Ä–∞–∑–æ–≤
| –¢–∏–ø | –†–∞–∑–º–µ—Ä | –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ | –ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ | –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è |
|-----|-------|--------------|------------|--------------|
| combined-ext4 | ~150MB | –ü—Ä–æ—Å—Ç–æ—Ç–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è, –∏–∑–º–µ–Ω—è–µ–º—ã–π | –ë–æ–ª—å—à–∏–π —Ä–∞–∑–º–µ—Ä | **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è** |
| combined-squashfs | ~80MB | –≠–∫–æ–Ω–æ–º–∏—è –º–µ—Å—Ç–∞, –∑–∞—â–∏—Ç–∞ –æ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π | –¢—Ä–µ–±—É–µ—Ç overlayfs | –î–ª—è CI |
| rootfs-ext4 | ~120MB | –ì–∏–±–∫–æ—Å—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ | –¢—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π —Å–±–æ—Ä–∫–∏ | –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö |
| generic-ext4 | ~140MB | –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å | –û–±—â–∏–µ –¥—Ä–∞–π–≤–µ—Ä—ã | –î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è |

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **CPU:** –ú–∏–Ω–∏–º—É–º 1 vCPU (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 2 –¥–ª—è QEMU KVM)
- **RAM:** –ú–∏–Ω–∏–º—É–º 256MB (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è 512MB)
- **–î–∏—Å–∫:** 1GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞ –¥–ª—è qcow2 overlay
- **–°–µ—Ç—å:** –î–æ—Å—Ç—É–ø –∫ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç—É –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –ø–∞–∫–µ—Ç–æ–≤

### –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–µ —Å—É–º–º—ã –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ SHA256 –¥–ª—è OpenWrt 24.10
wget https://downloads.openwrt.org/releases/24.10.0/targets/x86/64/openwrt-24.10.0-x86-64-generic-ext4-combined-efi.img.gz
echo "a1b2c3d4e5f6..." | sha256sum -c -
```

### –ö–æ–Ω—Å–æ–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø
```bash
# Serial console –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
qemu-system-x86_64 -nographic -serial mon:stdio \
  -drive if=virtio,file=openwrt.img,format=qcow2
```

## üîß –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –∫ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º–µ

### –ë–∞–∑–æ–≤—ã–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
```bash
# Ubuntu/Debian
sudo apt-get update
sudo apt-get install -y \
  qemu-system-x86 \
  qemu-img \
  qemu-utils \
  expect \
  sshpass \
  curl \
  wget \
  genisoimage \
  util-linux

# Arch Linux
sudo pacman -Syu
sudo pacman -S --needed \
  qemu \
  expect \
  sshpass \
  curl \
  wget \
  libisoburn \
  util-linux
```

### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —É—Ç–∏–ª–∏—Ç—ã
```bash
# –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Å–µ—Ç—å—é
sudo apt-get install -y bridge-utils uml-utilities

# –î–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
sudo apt-get install -y expect tcl

# –î–ª—è –æ—Ç–ª–∞–¥–∫–∏
sudo apt-get install -y tcpdump wireshark-common
```

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—ã kvm –∏ libvirt
sudo usermod -a -G kvm,libvirt $USER
newgrp kvm

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤
test -w /dev/kvm && echo "KVM –¥–æ—Å—Ç—É–ø–µ–Ω" || echo "KVM –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
```

### –°–µ—Ç–µ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ bridge –¥–ª—è —Å–µ—Ç–∏ VM
sudo brctl addbr br0
sudo ip addr add 192.168.100.1/24 dev br0
sudo ip link set br0 up

# –í–∫–ª—é—á–µ–Ω–∏–µ IP forwarding
echo 1 | sudo tee /proc/sys/net/ipv4/ip_forward
```

### –î–∏—Å–∫–æ–≤–æ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ
- **–ú–∏–Ω–∏–º—É–º:** 5GB —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** 20GB –¥–ª—è –∫—ç—à–∞ –æ–±—Ä–∞–∑–æ–≤ –∏ –ª–æ–≥–æ–≤
- **CI:** 10GB —Å –æ—á–∏—Å—Ç–∫–æ–π –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—É—Å–∫–∞

### –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
export OPENWRT_MIRROR="https://downloads.openwrt.org"
export OPENWRT_VERSION="24.10.0"
export OPENWRT_TARGET="x86/64"
export VM_MEMORY="512"
export VM_CPUS="2"
export VM_TIMEOUT="300"
```

## üöÄ –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å GitHub Actions CI

### –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è runners
- **–ù–µ—Ç nested virtualization:** –¢–æ–ª—å–∫–æ QEMU TCG
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã:** 2 CPU, 7GB RAM, 14GB –¥–∏—Å–∫–∞
- **–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ª–∏–º–∏—Ç—ã:** 6 —á–∞—Å–æ–≤ –¥–ª—è job
- **–°–µ—Ç–µ–≤—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è:** –û–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω–∞—è –ø—Ä–æ–ø—É—Å–∫–Ω–∞—è —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è CI
```yaml
- name: Setup QEMU for CI
  run: |
    # –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ TCG –≤–º–µ—Å—Ç–æ KVM
    export QEMU_CPU="max"
    # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø–∞–º—è—Ç–∏
    export VM_MEMORY="256"
    # –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤ –º–µ–∂–¥—É –∑–∞–ø—É—Å–∫–∞–º–∏
    echo "CACHE_DIR=$HOME/.cache/openwrt-images" >> $GITHUB_ENV
```

### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
```yaml
- name: Cache OpenWrt images
  uses: actions/cache@v4
  with:
    path: ~/.cache/openwrt-images
    key: openwrt-${{ env.OPENWRT_VERSION }}-${{ env.OPENWRT_TARGET }}
    restore-keys: |
      openwrt-${{ env.OPENWRT_VERSION }}-
      openwrt-
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–∞–º–∏
```yaml
- name: Upload VM logs
  uses: actions/upload-artifact@v4
  if: always()
  with:
    name: vm-logs-${{ github.run_number }}
    path: |
      vm-logs/
      test-results/
    retention-days: 7
```

### –û—Ü–µ–Ω–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
- **–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è:** 2-3 –º–∏–Ω—É—Ç—ã
- **–ó–∞–≥—Ä—É–∑–∫–∞ VM:** 3-5 –º–∏–Ω—É—Ç (TCG)
- **–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞:** 1-2 –º–∏–Ω—É—Ç—ã
- **–í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤:** 2-4 –º–∏–Ω—É—Ç—ã
- **–û—á–∏—Å—Ç–∫–∞:** 30 —Å–µ–∫—É–Ω–¥

**–ò—Ç–æ–≥–æ:** 8-14 –º–∏–Ω—É—Ç –Ω–∞ –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üîÑ –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π workflow

### –û–±—â–∞—è —Å—Ö–µ–º–∞ –ø—Ä–æ—Ü–µ—Å—Å–∞
```
1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
   ‚Üì
2. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ OpenWrt –æ–±—Ä–∞–∑–∞
   ‚Üì
3. –°–æ–∑–¥–∞–Ω–∏–µ qcow2 overlay
   ‚Üì
4. –ó–∞–ø—É—Å–∫ VM (QEMU)
   ‚Üì
5. –û–∂–∏–¥–∞–Ω–∏–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã
   ‚Üì
6. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–µ–π
   ‚Üì
7. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞ (.ipk)
   ‚Üì
8. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ UCI
   ‚Üì
9. –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏
   ‚Üì
10. –°–±–æ—Ä –ª–æ–≥–æ–≤ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤
    ‚Üì
11. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ VM –∏ –æ—á–∏—Å—Ç–∫–∞
```

### –ö–ª—é—á–µ–≤—ã–µ —ç—Ç–∞–ø—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏

#### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è
```bash
setup_environment() {
    mkdir -p "${VM_WORK_DIR}"
    cd "${VM_WORK_DIR}"
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    check_dependencies qemu-system-x86_64 qemu-img expect sshpass
    
    # –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏
    setup_tap_network
    
    # –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ SSH –∫–ª—é—á–µ–π
    ssh-keygen -t rsa -N "" -f vm_key
}
```

#### 2. –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–±—Ä–∞–∑–∞–º–∏
```bash
download_openwrt_image() {
    local base_url="${OPENWRT_MIRROR}/releases/${OPENWRT_VERSION}/targets/${OPENWRT_TARGET}"
    local image_name="openwrt-${OPENWRT_VERSION}-${OPENWRT_TARGET//\//-}-generic-ext4-combined-efi.img.gz"
    
    wget "${base_url}/${image_name}"
    gunzip "${image_name}"
    
    # –°–æ–∑–¥–∞–Ω–∏–µ overlay –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
    qemu-img create -f qcow2 -b "${image_name%.gz}" -F raw overlay.qcow2
}
```

#### 3. –ó–∞–ø—É—Å–∫ VM
```bash
start_vm() {
    qemu-system-x86_64 \
      -m "${VM_MEMORY}" \
      -smp "${VM_CPUS}" \
      -cpu "${QEMU_CPU:-host}" \
      -drive if=virtio,file=overlay.qcow2,format=qcow2 \
      -netdev tap,id=net0,ifname=tap0,script=no,downscript=no \
      -device virtio-net-pci,netdev=net0 \
      -nographic \
      -serial mon:stdio \
      -pidfile vm.pid \
      -daemonize
    
    # –û–∂–∏–¥–∞–Ω–∏–µ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ VM
    wait_for_vm_ready
}
```

#### 4. –ü—Ä–æ–≤–∏–∑–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ
```bash
provision_vm() {
    local vm_ip="192.168.100.2"
    
    # –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ SSH –∫–ª—é—á–∞
    ssh-copy-id -i vm_key.pub root@${vm_ip}
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
    ssh root@${vm_ip} "opkg update && opkg install curl dnsmasq-full"
    
    # –ó–∞–≥—Ä—É–∑–∫–∞ –ø–∞–∫–µ—Ç–∞
    scp openwrt-captive-monitor_*.ipk root@${vm_ip}:/tmp/
    
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø–∞–∫–µ—Ç–∞
    ssh root@${vm_ip} "opkg install /tmp/openwrt-captive-monitor_*.ipk"
}
```

#### 5. –í–∞–ª–∏–¥–∞—Ü–∏—è
```bash
run_validation() {
    local vm_ip="192.168.100.2"
    
    # –ë–∞–∑–æ–≤—ã–µ —Ç–µ—Å—Ç—ã
    ssh root@${vm_ip} "openwrt_captive_monitor --help"
    ssh root@${vm_ip} "openwrt_captive_monitor --oneshot"
    
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ firewall
    test_firewall_rules ${vm_ip}
    
    # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DNS redirects
    test_dns_redirects ${vm_ip}
    
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ cleanup
    test_cleanup ${vm_ip}
}
```

## üõ†Ô∏è –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Ä–∞–±–æ—á–µ–π —Å—Ç–∞–Ω—Ü–∏–∏

### –®–∞–≥ 1: –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt-get update && sudo apt-get upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ QEMU –∏ —É—Ç–∏–ª–∏—Ç
sudo apt-get install -y qemu-system-x86 qemu-utils qemu-img

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —É—Ç–∏–ª–∏—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏
sudo apt-get install -y expect sshpass curl wget

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö —É—Ç–∏–ª–∏—Ç
sudo apt-get install -y bridge-utils uml-utilities tcpdump
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞
```bash
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ –≥—Ä—É–ø–ø—ã
sudo usermod -a -G kvm,libvirt,input $USER

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
newgrp kvm

# –ü—Ä–æ–≤–µ—Ä–∫–∞
groups | grep kvm
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ç–∏
```bash
# –°–æ–∑–¥–∞–Ω–∏–µ TAP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
sudo tunctl -t tap0 -u $USER
sudo ip link set tap0 up

# –°–æ–∑–¥–∞–Ω–∏–µ bridge
sudo brctl addbr br0
sudo brctl addif br0 tap0
sudo ip addr add 192.168.100.1/24 dev br0
sudo ip link set br0 up

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ NAT
sudo iptables -t nat -A POSTROUTING -s 192.168.100.0/24 -j MASQUERADE
```

### –®–∞–≥ 4: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Ä–∞–±–æ—á–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
```bash
mkdir -p ~/openwrt-testing/{images,logs,scripts}
cd ~/openwrt-testing

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
cat > config.env << 'EOF'
export OPENWRT_VERSION="24.10.0"
export OPENWRT_TARGET="x86/64"
export VM_MEMORY="512"
export VM_CPUS="2"
export VM_TIMEOUT="300"
export VM_NETWORK="192.168.100.0/24"
export VM_IP="192.168.100.2"
export VM_HOST_IP="192.168.100.1"
EOF
```

### –®–∞–≥ 5: –¢–µ—Å—Ç–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞
```bash
# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–±—Ä–∞–∑–∞
wget https://downloads.openwrt.org/releases/24.10.0/targets/x86/64/openwrt-24.10.0-x86-64-generic-ext4-combined-efi.img.gz

# –†–∞—Å–ø–∞–∫–æ–≤–∫–∞
gunzip openwrt-24.10.0-x86-64-generic-ext4-combined-efi.img.gz

# –°–æ–∑–¥–∞–Ω–∏–µ overlay
qemu-img create -f qcow2 -b openwrt-24.10.0-x86-64-generic-ext4-combined-efi.img -F raw test-overlay.qcow2

# –¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫
qemu-system-x86_64 -m 512 -drive if=virtio,file=test-overlay.qcow2,format=qcow2 -netdev user,id=net0 -device virtio-net-pci,netdev=net0 -nographic
```

### –®–∞–≥ 6: –û—á–∏—Å—Ç–∫–∞ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
```bash
cleanup_testing() {
    # –û—Å—Ç–∞–Ω–æ–≤–∫–∞ VM
    if [ -f vm.pid ]; then
        kill $(cat vm.pid) 2>/dev/null || true
        rm -f vm.pid
    fi
    
    # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
    rm -f *.qcow2 *.img.gz
    
    # –û—á–∏—Å—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–æ–≤
    sudo ip link set tap0 down 2>/dev/null || true
    sudo ip link set br0 down 2>/dev/null || true
    sudo brctl delbr br0 2>/dev/null || true
    
    # –û—á–∏—Å—Ç–∫–∞ –ª–æ–≥–æ–≤
    rm -f logs/*
}
```

## üîó –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å—Ç—Ä–∞—Ç–µ–≥–∏–µ–π QA

### –°–æ–æ—Ç–Ω–æ—à–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º —Ç–µ—Å—Ç-–ø–ª–∞–Ω–æ–º
| –£—Ä–æ–≤–µ–Ω—å | –°—É—â–µ—Å—Ç–≤—É—é—â–∏–π –ø–æ–¥—Ö–æ–¥ | –í–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ |
|---------|-------------------|------------------------------|
| Unit-—Ç–µ—Å—Ç—ã | Mock-based —Ç–µ—Å—Ç—ã | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π |
| –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ | –≠–º—É–ª—è—Ü–∏—è OpenWrt –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä | –ü–æ–ª–Ω–∞—è VM —ç–º—É–ª—è—Ü–∏—è |
| –°–∏—Å—Ç–µ–º–Ω—ã–µ | –†—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–µ | –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ VM —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ |
| –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–µ | –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ | CI/CD –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è |

### –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ docs/TEST_PLAN.md
–í–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –º–µ–∂–¥—É "–≠–º—É–ª—è—Ü–∏—è OpenWrt 24.x" –∏ "–ü–æ–ª–µ–≤—ã–µ –∏—Å–ø—ã—Ç–∞–Ω–∏—è":

```markdown
## 2.5. –í–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (CI/–ª–æ–∫–∞–ª—å–Ω–æ–µ)
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –ø–æ–ª–Ω–æ–π VM OpenWrt
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å—Ç–∞–Ω–æ–≤—â–∏–∫–∞ –∏ init-—Å–∫—Ä–∏–ø—Ç–æ–≤
- –ü—Ä–æ–≤–µ—Ä–∫–∞ firewall –ø—Ä–∞–≤–∏–ª –≤ —Ä–µ–∞–ª—å–Ω–æ–π —Å—Ä–µ–¥–µ
- –†–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ CI
```

### –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ docs/index.md
–î–æ–±–∞–≤–∏—Ç—å –≤ —Ä–∞–∑–¥–µ–ª "üìã Development":
```markdown
- [Virtualized Testing Guide](guides/virtualized-testing.md) - VM-based testing strategy and automation
```

### –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞
- **–ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏:** –î–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ mock-based —Ç–µ—Å—Ç–∞–º
- **–í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è:** 8-14 –º–∏–Ω—É—Ç –≤ CI
- **–ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å:** >95% —É—Å–ø–µ—à–Ω—ã—Ö –∑–∞–ø—É—Å–∫–æ–≤
- **–û–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ –¥–µ—Ñ–µ–∫—Ç–æ–≤:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã, –Ω–µ –≤–∏–¥–∏–º—ã–µ –≤ mocks

## üìä –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ –≤–Ω–µ–¥—Ä–µ–Ω–∏—é

### –§–∞–∑–∞ 1: –ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (1-2 –Ω–µ–¥–µ–ª–∏)
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–∑–æ–≤—ã—Ö —Å–∫—Ä–∏–ø—Ç–æ–≤ –¥–ª—è VM —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π —Å–±–æ—Ä–∫–æ–π .ipk
- –ü—Ä–æ—Å—Ç–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è (—É—Å—Ç–∞–Ω–æ–≤–∫–∞, –∑–∞–ø—É—Å–∫, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏)

### –§–∞–∑–∞ 2: –†–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (2-3 –Ω–µ–¥–µ–ª–∏)
- –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ firewall –ø—Ä–∞–≤–∏–ª
- –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ DNS/HTTP redirects
- –í–∞–ª–∏–¥–∞—Ü–∏—è cleanup –ø—Ä–æ—Ü–µ–¥—É—Ä
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å GitHub Actions

### –§–∞–∑–∞ 3: –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∏ CI/CD (1-2 –Ω–µ–¥–µ–ª–∏)
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤
- –ü–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
- –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è CI runners
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –æ—Ç—á—ë—Ç–æ–≤ –∏ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤

## üîç –û—Ç–ª–∞–¥–∫–∞ –∏ troubleshooting

### –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã
```bash
# VM –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
qemu-system-x86_64: -drive if=virtio,file=overlay.qcow2,format=qcow2: Could not open 'overlay.qcow2': No such file or directory
# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞

# –ù–µ—Ç —Å–µ—Ç–∏ –≤ VM
# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ TAP –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ –∏ bridge

# SSH –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
# –†–µ—à–µ–Ω–∏–µ: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å IP –∞–¥—Ä–µ—Å –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π—Ä–≤–æ–ª–∞

# –¢–µ—Å—Ç—ã –ø–∞–¥–∞—é—Ç –ø–æ —Ç–∞–π–º–∞—É—Ç—É
# –†–µ—à–µ–Ω–∏–µ: –£–≤–µ–ª–∏—á–∏—Ç—å VM_TIMEOUT –∏–ª–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
```

### –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –æ—Ç–ª–∞–¥–∫–∏
```bash
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ VM
qemu-monitor -h $(cat vm.pid)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ—Ç–∏
tcpdump -i tap0 -n

# –õ–æ–≥–∏ VM
ssh root@${VM_IP} "logread | grep captive"

# –°—Ç–∞—Ç—É—Å —Å–µ—Ä–≤–∏—Å–æ–≤
ssh root@${VM_IP} "/etc/init.d/captive-monitor status"
```

## üìù –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

–í–∏—Ä—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –º–æ—â–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞—Ä–∏–π –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏ OpenWrt –ø–∞–∫–µ—Ç–æ–≤, –¥–æ–ø–æ–ª–Ω—è—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ mock-based —Ç–µ—Å—Ç—ã –∏ —Ä—É—á–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞ –æ–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–∏. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å CI/CD –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–±–µ—Å–ø–µ—á–∏—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å —Ä–µ–ª–∏–∑–æ–≤ –∏ —Ä–∞–Ω–Ω–µ–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–π.

–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –Ω–∞—á–∞—Ç—å —Å –±–∞–∑–æ–≤–æ–π –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Ä–∞—Å—à–∏—Ä—è—Ç—å —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, –æ–ø–∏—Ä–∞—è—Å—å –Ω–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç–∏ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –¥–æ—Å—Ç—É–ø–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã CI.